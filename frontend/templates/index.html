<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>EchoMind</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <style>
    /* --- CORE VARIABLES --- */
    :root {
      --bg-color: #0f172a;
      --card-bg: #1e293b;
      --primary: #7c5cff;
      --primary-hover: #6c4ce5;
      --text-main: #f8fafc;
      --text-muted: #94a3b8;
      --border-light: rgba(255, 255, 255, 0.12);
      --input-bg: rgba(0, 0, 0, 0.25);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0; padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
    }

    /* --- 1. SPLASH SCREEN ANIMATION CSS --- */
    #splash-screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: var(--bg-color);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 9999; transition: opacity 0.5s ease-out;
    }
    .splash-logo {
      font-size: 3rem; font-weight: 800; color: var(--primary);
      margin-bottom: 20px; animation: fadeIn 1s ease-in; letter-spacing: -1px;
      text-shadow: 0 0 20px rgba(124, 92, 255, 0.3);
    }
    .loading-dots { display: flex; gap: 8px; }
    .dot {
      width: 12px; height: 12px; background-color: var(--text-muted); border-radius: 50%;
      animation: pulse 1.2s infinite ease-in-out both;
    }
    .dot:nth-child(1) { animation-delay: -0.32s; }
    .dot:nth-child(2) { animation-delay: -0.16s; }
    @keyframes pulse {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; background-color: var(--primary); box-shadow: 0 0 10px var(--primary); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* --- MAIN LAYOUT --- */
    #main-content {
      display: none; opacity: 0; transition: opacity 0.5s ease-in;
      padding-top: 70px; padding-bottom: 50px; min-height: 100vh; position: relative;
    }
    .hidden { opacity: 0 !important; pointer-events: none; }

    header {
      position: fixed; top: 0; left: 0; width: 100%; height: 60px;
      background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-light);
      z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
    }
    /* Animated Logo */
    @keyframes logo-shimmer {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .header-logo {
      font-size: 1.7rem; font-weight: 900; letter-spacing: -1px; text-decoration: none;
      background: linear-gradient(to right, #7c5cff 20%, #38bdf8 50%, #7c5cff 80%);
      background-size: 200% auto; -webkit-background-clip: text; background-clip: text;
      -webkit-text-fill-color: transparent; color: transparent;
      animation: logo-shimmer 3s linear infinite;
      filter: drop-shadow(0 0 10px rgba(124, 92, 255, 0.3));
    }
    .header-tagline { font-size: 0.85rem; color: var(--text-muted); font-weight: 500; }

    /* --- FOOTER --- */
    footer {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 40px;
      background: var(--card-bg); color: var(--text-muted);
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem; font-weight: 600; z-index: 1000;
      border-top: 1px solid var(--border-light);
      cursor: pointer; transition: color 0.3s ease; user-select: none;
    }
    footer:hover { color: var(--primary); text-decoration: underline; }

    .container { max-width: 1100px; margin: 0 auto; padding: 15px; }

    /* --- CARD STYLES --- */
    .card {
      background: var(--card-bg); border: 1px solid var(--border-light);
      border-radius: 12px; padding: 25px; margin-bottom: 20px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
    }
    .card h3 { margin-top: 0; color: var(--text-main); font-size: 1.2rem; }

    /* --- FORM ELEMENTS --- */
    form { text-align: left; }
    label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--text-muted); font-size: 0.9rem; }

    input[type="text"], select {
      width: 100%; padding: 12px; margin-bottom: 20px;
      border: 1px solid var(--border-light); border-radius: 8px; font-size: 1rem;
      background: var(--input-bg); color: var(--text-main);
      transition: all 0.2s; appearance: none;
    }
    input::placeholder { color: #555c69; }
    input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(124, 92, 255, 0.2); }

    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      cursor: pointer;
    }

    .file-upload-wrapper { position: relative; width: 100%; margin-bottom: 20px; }
    input[type="file"] {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0); border: 0;
    }
    .file-upload-label {
      display: flex; align-items: center; justify-content: center; gap: 10px;
      width: 100%; padding: 12px;
      border: 1px dashed var(--text-muted);
      border-radius: 8px; background: rgba(255, 255, 255, 0.03);
      color: var(--text-muted); cursor: pointer; font-size: 0.95rem;
      transition: all 0.2s ease; text-align: center;
    }
    .file-upload-label:hover {
      background: rgba(255, 255, 255, 0.07); border-color: var(--primary); color: var(--text-main);
    }
    .file-upload-label.has-file {
      border-style: solid; border-color: var(--primary);
      background: rgba(124, 92, 255, 0.1); color: var(--primary); font-weight: 500;
    }

    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .warn { color: #ef4444; font-size: 0.75rem; display: block; margin-top: -15px; margin-bottom: 15px; }

    /* Action Buttons */
    button {
      width: 100%; background-color: var(--primary); color: white;
      padding: 14px; font-size: 1rem; font-weight: 600; border: none;
      border-radius: 8px; cursor: pointer; margin-top: 5px;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 4px 6px rgba(124, 92, 255, 0.25);
    }
    button:hover { background-color: var(--primary-hover); }
    button:active { transform: scale(0.98); }
    button:disabled { opacity: 0.65; cursor: not-allowed; transform: none; }

    /* Mode Toggles */
    .mode-row{ display:flex; gap:10px; flex-wrap:wrap; margin-bottom:16px; }
    .mode-btn{
      flex:1; min-width: 180px; padding: 10px 12px; border-radius: 999px;
      border: 1px solid var(--border-light); background: rgba(255,255,255,0.04);
      color: var(--text-muted); cursor:pointer; font-weight:700;
      transition: all .15s ease; text-align:center; user-select:none;
    }
    .mode-btn.active{
      border-color: rgba(124,92,255,0.65); background: rgba(124,92,255,0.14);
      color: var(--text-main); box-shadow: 0 0 0 2px rgba(124, 92, 255, 0.18);
    }
    .section-hide{ display:none; }

    /* Layout Grid */
    .layout-grid {
      display: grid;
      grid-template-columns: 1fr 280px; /* Left takes space, Right fixed width */
      gap: 20px;
      align-items: start;
      transition: all 0.3s ease;
    }
    .layout-grid.mode-center {
      grid-template-columns: 1fr;
      max-width: 700px;
      margin: 0 auto;
    }
    .layout-grid.mode-center .side-column { display: none !important; }

    /* Instructions */
    #cache-section { font-size: 0.85rem; padding: 15px 20px; }
    #cache-section h3 { font-size: 1rem; margin-bottom: 10px; }
    #cache-section ol { padding-left: 15px; margin-top: 0; line-height: 1.5; }
    #cache-section li { margin-bottom: 8px; }

    /* --- NEW VOICE UI STYLES --- */
    .voice-container {
        display: flex; flex-direction: column; align-items: center;
        padding: 20px 0; margin-bottom: 25px;
        background: rgba(0,0,0,0.15); border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);
    }
    .mic-button-wrapper {
        position: relative; width: 100px; height: 100px;
        display: flex; align-items: center; justify-content: center;
        margin-bottom: 15px;
    }
    .mic-button {
        width: 70px; height: 70px;
        border-radius: 50%;
        background: #fff; color: var(--bg-color);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; z-index: 2;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    }
    .mic-button svg { width: 28px; height: 28px; fill: currentColor; }
    .mic-button:hover { transform: scale(1.05); }
    .mic-button.active { transform: scale(1.1); background: #ef4444; color: white; }
    
    /* Animation Rings */
    .mic-ring {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 100%; height: 100%; border-radius: 50%;
        border: 2px solid var(--primary); opacity: 0; pointer-events: none;
    }
    .mic-button.active ~ .mic-ring { animation: ripple 1.5s infinite; }
    @keyframes ripple {
        0% { width: 70px; height: 70px; opacity: 0.8; border-width: 4px; }
        100% { width: 160px; height: 160px; opacity: 0; border-width: 0px; }
    }

    /* Status Text */
    #voice-status { font-size: 1rem; font-weight: 600; color: var(--text-main); margin-bottom: 5px; min-height: 24px; }
    .transcript-box {
        background: rgba(0,0,0,0.25); padding: 12px; border-radius: 8px;
        width: 90%; margin-top: 10px; border: 1px solid var(--border-light);
        display: none; text-align: left;
    }
    .transcript-box.visible { display: block; animation: fadeIn 0.5s; }
    .transcript-label { font-size: 0.7rem; text-transform: uppercase; color: var(--primary); letter-spacing: 1px; font-weight: 700; margin-bottom: 4px; }
    .transcript-text { font-size: 0.9rem; line-height: 1.4; color: #cbd5e1; }
    
    .divider-text { 
        text-align:center; border-bottom:1px solid var(--border-light); 
        line-height:0.1em; margin: 30px 0 25px; color: var(--text-muted); 
    }
    .divider-text span { background: var(--card-bg); padding:0 10px; font-size: 0.85rem;}


    /* Modal */
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(8px);
      z-index: 9999; justify-content: center; align-items: center;
      opacity: 0; transition: opacity 0.3s ease;
    }
    .modal-overlay.active { display: flex; opacity: 1; }
    .modal-content {
      background: #1e293b; border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 40px; border-radius: 20px; width: 90%; max-width: 900px;
      position: relative; text-align: center;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      transform: scale(0.95); transition: transform 0.3s ease;
    }
    .modal-overlay.active .modal-content { transform: scale(1); }
    .modal-close {
      position: absolute; top: 15px; right: 15px;
      background: rgba(255,255,255,0.1); border: none; color: #fff;
      font-size: 24px; width: 32px; height: 32px; border-radius: 50%;
      cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s;
    }
    .modal-close:hover { background: #ef4444; transform: rotate(90deg); }
    .modal-content h2 { margin: 0 0 5px 0; color: var(--primary); font-size: 2rem; }
    .team-subtitle { color: var(--text-muted); margin-bottom: 30px; font-size: 0.95rem; }
    .team-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; align-items: start; }
    .team-card {
      background: rgba(255,255,255,0.03); padding: 25px 15px;
      border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); transition: 0.3s ease;
    }
    .team-card:hover { background: rgba(255,255,255,0.07); border-color: var(--primary); transform: translateY(-5px); }
    .img-wrapper {
      width: 110px; height: 110px; margin: 0 auto 15px;
      border-radius: 50%; padding: 3px; border: 2px solid var(--primary); overflow: hidden;
    }
    .img-wrapper img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
    .team-card h3 { margin: 10px 0 5px; font-size: 1.1rem; color: #fff; }
    .role { display: block; font-size: 0.8rem; color: var(--primary); margin-bottom: 15px; font-weight: 700; text-transform: uppercase; }
    .social-links { display: flex; justify-content: center; gap: 10px; }
    .social-icon {
      color: var(--text-muted); padding: 8px; background: rgba(255,255,255,0.05);
      border-radius: 8px; display: flex; transition: 0.2s;
    }
    .social-icon:hover { color: #fff; transform: translateY(-2px); }

    @media (max-width: 850px) {
      .layout-grid { grid-template-columns: 1fr; }
      .header-tagline { display: none; }
    }
    @media (max-width: 768px) { .team-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>

  <div id="splash-screen">
    <div class="splash-logo" id="splash-text">EchoMind</div>
    <div class="loading-dots">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </div>

  <div id="main-content">

    <header>
      <div class="header-logo">EchoMind</div>
      <div class="header-tagline">Explainable AI</div>
    </header>

    <div class="container">

      <div class="layout-grid" id="layout-container">
        
        <div class="main-column">
          
          <div class="card">
            <h3>Mode</h3>
            <div class="mode-row">
              <div class="mode-btn active" id="btn-project">Echo-Vision</div>
              <div class="mode-btn" id="btn-chat">Echo-Bot</div>
            </div>
            <p style="color:var(--text-muted);margin:0; font-size:0.9rem;">
              Echo-Vision Mode = video analysis • Echo-Bot Mode = interactive assistant.
            </p>
          </div>

          <div class="card" id="project-section">
            <form id="analysis-form" action="/run" method="post" enctype="multipart/form-data">
              <div class="grid">
                <div>
                  <label>Upload Video File</label>
                  <div class="file-upload-wrapper">
                    <input type="file" id="video_file" name="video_file" accept="video/*"/>
                    <label for="video_file" class="file-upload-label" id="file-label-text">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                      <span>Choose Video...</span>
                    </label>
                  </div>
                </div>

                <div>
                  <label>OR Video URL</label>
                  <input type="text" name="video_url" placeholder="https://youtube.com/..."/>
                  <small class="warn">Offline Mode: Must exist in backend cache.</small>
                </div>
              </div>

              <label>Analysis Language Context</label>
              <select name="text_hint">
                <option value="English">English</option>
                <option value="Bangla">Bangla</option>
              </select>

              <button type="submit" id="btn-run-analysis">Run Analysis</button>
            </form>
          </div>

          <div class="card section-hide" id="chat-section">
            
            <div class="voice-container">
                <div class="mic-button-wrapper">
                    <div class="mic-button" id="mic-trigger">
                        <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                    </div>
                    <div class="mic-ring"></div>
                </div>

                <div id="voice-status">Tap to speak</div>
                
                <div id="transcript-area" class="transcript-box">
                    <div class="transcript-label">You said:</div>
                    <div class="transcript-text" id="voice-user-text">...</div>
                </div>

                <div id="reply-area" class="transcript-box">
                    <div class="transcript-label">EchoMind:</div>
                    <div class="transcript-text" id="voice-ai-text">...</div>
                </div>

                <audio id="voice-audio" style="display:none"></audio>
            </div>

            <div class="divider-text"><span>OR TYPE BELOW</span></div>

            <form id="chat-form" action="/chat" method="post" autocomplete="off">
              <label>Chat Session ID (optional)</label>
              <input type="text" name="session_id" id="session_id" placeholder="default_session" value="default_session"/>

              <label>Chatbot Mood</label>
              <select name="mood" id="mood">
                <option value="default">Default</option>
                <option value="friendly">Friendly</option>
                <option value="tutor">Tutor</option>
                <option value="analyst">Analyst</option>
              </select>

              <label>Your Message</label>
              <input type="text" name="message" placeholder="Ask anything..." required />

              <button type="submit" id="btn-send-chat">Send to EchoBot</button>

              <p style="color:var(--text-muted);margin-top:10px; font-size:0.85rem">
                Tip: Ensure <b>ollama serve</b> is running and model <b>llama3.1:8b</b> is pulled.
              </p>
            </form>
          </div>

        </div> 
        
        <div class="side-column">
          <div class="card" id="cache-section">
            <h3>Offline Cache Instructions</h3>
            <ol>
              <li>Paste your URL in the box.</li>
              <li>If "not found", copy URL Key.</li>
              <li>Place video in: <br><b>backend/storage/url_cache/</b></li>
              <li>Rename file to: <br><b>&lt;URL_KEY&gt;.mp4</b></li>
              <li>Run again to process.</li>
            </ol>
          </div>
        </div>

      </div> </div>

    <footer id="footer-trigger">
      Developed by: Team-EchoMind (Click to View)
    </footer>

  </div>
  
  <div id="dev-modal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" id="close-btn">×</button>
      <h2>Meet the Team</h2>
      <p class="team-subtitle">The minds behind EchoMind</p>
      <div class="team-grid">
        <div class="team-card">
          <div class="img-wrapper">
            <img src="/static/images/member1.jpg" alt="Member 1" onerror="this.src='https://via.placeholder.com/100?text=IMG'">
          </div>
          <h3>Rakib Biswash</h3>
          <span class="role">Software Engineer</span>
          <div class="social-links">
            <a href="https://github.com/banrayndox" target="_blank" class="social-icon github"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
            <a href="https://linkedin.com/in/banrayndox" target="_blank" class="social-icon linkedin"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
          </div>
        </div>
        <div class="team-card">
          <div class="img-wrapper">
            <img src="/static/images/member2.jpg" alt="Member 2" onerror="this.src='https://via.placeholder.com/100?text=IMG'">
          </div>
          <h3>Alfi Shahrin</h3>
          <span class="role">AI Engineer</span>
          <div class="social-links">
            <a href="https://github.com/Alfi-svg" target="_blank" class="social-icon github"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
            <a href="https://www.linkedin.com/in/alfi-shahrin-talukder-a68450370/" target="_blank" class="social-icon linkedin"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
          </div>
        </div>
        <div class="team-card">
          <div class="img-wrapper">
            <img src="/static/images/member3.jpg" alt="Member 3" onerror="this.src='https://via.placeholder.com/100?text=IMG'">
          </div>
          <h3>Samiul Islam</h3>
          <span class="role">ML Engineer</span>
          <div class="social-links">
            <a href="https://github.com/" target="_blank" class="social-icon github"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a>
            <a href="https://www.linkedin.com/in/samiul-islam2/" target="_blank" class="social-icon linkedin"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      
      // --- 1. Splash Screen Logic ---
      const splash = document.getElementById('splash-screen');
      const mainContent = document.getElementById('main-content');
      
      // Fade out splash on load
      setTimeout(() => {
        splash.style.opacity = '0';
        mainContent.style.display = 'block';
        setTimeout(() => { mainContent.style.opacity = '1'; }, 50);
        setTimeout(() => { splash.style.display = 'none'; }, 500);
      }, 1500);

      // --- 2. Mode Toggle Logic ---
      const btnProject = document.getElementById("btn-project");
      const btnChat = document.getElementById("btn-chat");
      const projectSection = document.getElementById("project-section");
      const chatSection = document.getElementById("chat-section");
      const layoutContainer = document.getElementById("layout-container");

      function setMode(mode){
        if(mode === "chat"){
          btnChat.classList.add("active");
          btnProject.classList.remove("active");
          layoutContainer.classList.add("mode-center"); 
          projectSection.classList.add("section-hide");
          chatSection.classList.remove("section-hide");
        } else {
          btnProject.classList.add("active");
          btnChat.classList.remove("active");
          layoutContainer.classList.remove("mode-center"); 
          chatSection.classList.add("section-hide");
          projectSection.classList.remove("section-hide");
        }
      }

      if(btnProject && btnChat) {
        btnProject.addEventListener("click", () => setMode("project"));
        btnChat.addEventListener("click", () => setMode("chat"));
      }

      // --- 3. File Input UI ---
      const fileInput = document.getElementById('video_file');
      const fileLabel = document.getElementById('file-label-text');
      if (fileInput && fileLabel) {
        const fileLabelSpan = fileLabel.querySelector('span');
        fileInput.addEventListener('change', function() {
          if (this.files && this.files.length > 0) {
            let name = this.files[0].name;
            if (name.length > 25) name = name.substring(0, 22) + "...";
            if(fileLabelSpan) fileLabelSpan.textContent = name;
            fileLabel.classList.add('has-file');
          } else {
            if(fileLabelSpan) fileLabelSpan.textContent = "Choose Video...";
            fileLabel.classList.remove('has-file');
          }
        });
      }

      // --- 4. FORM LOCKING & ANIMATION TRIGGER ---
      function lockFormSubmit(formEl, btnId, busyText){
        if (!formEl) return;
        const btn = document.getElementById(btnId);
        formEl.addEventListener('submit', function(e) {
          if (formEl.dataset.submitting === "1") { e.preventDefault(); return; }
          formEl.dataset.submitting = "1";
          if (btn) btn.disabled = true;
          
          splash.style.display = 'flex';
          splash.style.opacity = '1';
          document.getElementById('splash-text').textContent = busyText;
        });
      }
      lockFormSubmit(document.getElementById('analysis-form'), "btn-run-analysis", "Analyzing...");
      lockFormSubmit(document.getElementById('chat-form'), "btn-send-chat", "Sending...");

      // --- 5. Modal Logic ---
      const modal = document.getElementById('dev-modal');
      const footerTrigger = document.getElementById('footer-trigger');
      const closeBtn = document.getElementById('close-btn');

      if(footerTrigger && modal) {
        footerTrigger.addEventListener('click', () => { modal.classList.add('active'); });
      }
      function hideModal() { if(modal) modal.classList.remove('active'); }
      if(closeBtn) closeBtn.addEventListener('click', hideModal);
      if(modal) modal.addEventListener('click', (e) => { if (e.target === modal) hideModal(); });

      // --- 6. VOICE RECORDER LOGIC (ChatGPT Style) ---
      let mediaRecorder = null;
      let recordedChunks = [];

      const micTrigger = document.getElementById("mic-trigger");
      const statusText = document.getElementById("voice-status");
      const userBox = document.getElementById("transcript-area");
      const aiBox = document.getElementById("reply-area");
      const userText = document.getElementById("voice-user-text");
      const aiText = document.getElementById("voice-ai-text");
      const audioEl = document.getElementById("voice-audio");
      
      const sessionInput = document.getElementById("session_id");
      const moodInput = document.getElementById("mood");

      let isRecording = false;

      async function processAudio(blob) {
        // UI State: Thinking
        statusText.textContent = "Thinking...";
        micTrigger.style.background = "#fbbf24"; // Yellow for processing
        
        const fd = new FormData();
        fd.append("audio", blob, "recording.webm");
        fd.append("mood", moodInput ? moodInput.value : "friendly");
        fd.append("session_id", sessionInput ? sessionInput.value : "default_session");
        fd.append("language", "auto");

        try {
            const res = await fetch("/chat/voice", { method: "POST", body: fd });
            const data = await res.json();

            // UI State: Reset
            micTrigger.style.background = "#fff"; // Back to white
            statusText.textContent = "Tap to speak";

            if (data.ok) {
                // Show text
                userBox.classList.add('visible');
                aiBox.classList.add('visible');
                userText.textContent = data.transcript || "...";
                aiText.textContent = data.reply_text || "...";

                // Play Audio
                if (data.reply_audio_url) {
                    audioEl.src = data.reply_audio_url;
                    statusText.textContent = "EchoMind is speaking...";
                    audioEl.play().catch(e => console.log("Auto-play blocked"));
                    
                    audioEl.onended = () => {
                        statusText.textContent = "Tap to reply";
                    };
                }
            } else {
                statusText.textContent = "Error: " + (data.error || "Unknown");
            }

        } catch (e) {
            statusText.textContent = "Connection Error";
            micTrigger.style.background = "#ef4444"; // Error red
        }
      }

      async function toggleRecording() {
        if (!isRecording) {
            // START RECORDING
            recordedChunks = [];
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream, { mimeType: "audio/webm;codecs=opus" });
                
                mediaRecorder.ondataavailable = (e) => {
                    if (e.data && e.data.size > 0) recordedChunks.push(e.data);
                };

                mediaRecorder.onstop = () => {
                    const blob = new Blob(recordedChunks, { type: "audio/webm" });
                    stream.getTracks().forEach(t => t.stop());
                    processAudio(blob); // Auto-send on stop
                };

                mediaRecorder.start();
                isRecording = true;
                
                // UI Updates
                micTrigger.classList.add("active");
                statusText.textContent = "Listening...";
                
                // Hide old chats initially to focus on voice
                userBox.classList.remove('visible');
                aiBox.classList.remove('visible');

            } catch(err) {
                alert("Microphone denied: " + err);
            }
        } else {
            // STOP RECORDING
            if (mediaRecorder && mediaRecorder.state !== "inactive") {
                mediaRecorder.stop();
            }
            isRecording = false;
            micTrigger.classList.remove("active");
        }
      }

      if (micTrigger) {
          micTrigger.addEventListener("click", toggleRecording);
      }
    });
  </script>

</body>
</html>